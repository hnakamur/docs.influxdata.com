---
title: Upgrading from previous versions

menu:
  influxdb_010:
    weight: 30
    parent: administration
---

If you're thinking about upgrading or if you've recently upgraded from InfluxDB 0.9 to 0.10, there are several steps you should consider taking to ease the transition:

* [Generate a new configuration file](/influxdb/v0.10/administration/upgrading/#generate-a-new-configuration-file)
* [Convert b1 and bz1 shards to tsm1](/influxdb/v0.10/administration/upgrading/#convert-b1-and-bz1-shards-to-tsm1)
* [Revisit any existing continuous queries](/influxdb/v0.10/administration/upgrading/#revisit-any-existing-continuous-queries)

## Generate a new configuration file

InfluxDB 0.10 has several new settings in the [configuration file](/influxdb/v0.10/administration/config/).

The `influxd config` command prints out a new TOML-formatted configuration with all the available configuration options set to their default values. On POSIX systems, a new configuration file can be generated by redirecting the output of the command to a file.

```
influxd config > /etc/influxdb/influxdb.conf.generated
```

## Convert b1 and bz1 shards to tsm1
InfluxDB version 0.10 uses a new default storage engine, `tsm1`.
Converting old `b1` and `bz1` shards to `tsm1` format results in a significant reduction in disk usage, and significantly improved write-throughput, when writing data into those shards.

`influx_tsm` is a tool for converting old `b1` and `bz1` shards to `tsm1` format. Before you get started, there are several things to note:

* Conversion is an offline process (the InfluxDB system must be stopped during the conversion). However, `influx_tsm` reads and writes shards directly on disk so the conversion should be fast.
* The tool automatically ignores `tsm1` shards.
* Conversion can be controlled on a database-by-database basis and can be run idempotently on any database.
* By default, the tool backs up databases so that you can undo a conversion (we cover how to undo a conversion [below](/influxdb/v0.10/administration/upgrading/#roll-back-a-conversion)). Before you start, ensure that the host system has at least as much free disk space as the disk space consumed by the data directory of your InfluxDB system.

#### Conversion steps

1. Stop all write traffic to your InfluxDB system.
2. Stop the InfluxDB service.
3. Ensure that all data are present in shards by restarting the InfluxDB service and waiting until all WAL data is flushed to disk. This is complete when the system responds to queries.
4. Stop the InfluxDB service. Do not restart the service until you've completed the conversion.
5. Create a directory for the backup. Here, we call it `influxdb_backup`:

    ```
mkdir ~/influxdb_backup
    ```
6. Run the conversion tool.

    To convert all databases, and where `~/influxdb_backup` is the directory for the backup and `~/.influxdb/data` is your data directory, enter:

    ```
influx_tsm -backup ~/influxdb_backup ~/.influxdb/data
    ```

    When you run `influx_tsm`, the tool will first list the shards to be converted and will ask for confirmation. You can abort the conversion process at this step if you just wish to see what would be converted, or if the list of shards does not look correct.

    > **Note:** By default, the conversion operation performs each operation in a serial manner. This minimizes load on the host system performing the conversion, but also takes the most time. If you wish to minimize the time conversion takes, enable parallel mode with `-parallel`:
    ```
    influx_tsm -backup ~/influxdb_backup -parallel ~/.influxdb/data
    ```
    Conversion will then perform as many operations as possible in parallel, but the process may place significant load on the host system (CPU, disk, and RAM, usage will all increase).  

    > Enter `influx_tsm -h` for a complete list of the tool's options.
7. If you ran the conversion tool as a different user from the user who runs InfluxDB, check and, if necessary, set the correct read and write permissions on the new `tsm1` directories.
8. Restart InfluxDB and ensure that the data look correct.
9. If everything looks correct, you may then wish to remove or archive the backed-up databases in your backup directory (`~/influxdb_backup`):
    ```
rm -r ~/influxdb_backup
    ```
10. Restart write traffic and you're done!

#### Roll back a conversion
After a successful backup, you have a duplicate of you database(s) in the backup directory you provided on the command line.
If, when checking your data after a successful conversion, you notice things missing or something just isn't right, you can "undo" the conversion.

1. Shut down your node (this is very important).
2. Remove the database's directory from the influxdb data directory. Where `~/.influxdb/data/` is your data directory and `stats` is the name of the database you'd like to remove:

    ```
    rm -r ~/.influxdb/data/stats
    ```
3. Copy the database's directory from the backup directory you created (`~/influxdb_backup/stats`) into the data directory (`~/.influxdb/data/`):

    ```
     cp -r ~/influxdb_backup/stats ~/.influxdb/data/
    ```
4. Restart InfluxDB.

## Revisit any existing continuous queries

In InfluxDB 0.9 the `CREATE CONTINUOUS QUERY` statement defines the Continuous Query’s (CQ) database and the query to be performed. Settings in the `[continuous_queries]` section of the configuration file control the frequency at which the CQ runs and how much historical data the CQ covers. All CQs share the same configuration settings; this makes it difficult to optimize CQ execution for both short and long sampling intervals.

In InfluxDB 0.10 the `CREATE CONTINUOUS QUERY` statement also controls CQ execution. By default, CQs run at the same interval as the CQ’s `GROUP BY time()` interval, and the system calculates the query for the most recent `GROUP BY time()` interval. A new and optional `RESAMPLE` clause allows users to specify how often the CQ runs and the time range over which InfluxDB runs the CQ. Finally, the 0.9 CQ configuration settings are no longer in the configuration file and have been replaced by a single setting which controls how often InfluxDB checks to see if a CQ needs to run.

CQs defined in InfluxDB 0.9 will still run in InfluxDB 0.10, but at a reduced frequency and with no resampling of data. This new behavior can result in incomplete downsampling of your data. We strongly recommend that you:

1. [Delete](/influxdb/v0.10/query_language/continuous_queries/#delete-cqs-with-drop) CQs that were defined in InfluxDB 0.9.
2. Redefine those CQs with the [new 0.10 syntax](/influxdb/v0.10/query_language/continuous_queries/#the-create-continuous-query-statement).
